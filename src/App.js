import React, { useState, useEffect } from 'react';
import pict from '../src/pict.png'

function App() {
  const [нормаЧасов, установитьНормуЧасов] = useState(167);
  const [оклад, установитьОклад] = useState(100000);
  const [массив1, установитьМассив1] = useState([ ]);
  const [массив2, установитьМассив2] = useState([ ]);
  const [результаты, установитьРезультаты] = useState(null);

  const рассчитатьИтоговуюЗП = () => {
    const новыеРезультаты = рассчитатьЗарплату(массив1, массив2, нормаЧасов, оклад);
    установитьРезультаты(новыеРезультаты);
  };
  const ценаЧаса = оклад / нормаЧасов;
  const ценаЧасаПереработки = ценаЧаса * 1.5; // Пусть переработка оплачивается с коэффициентом 1.5
  useEffect(() => {
    const новыеРезультаты = рассчитатьЗарплату(массив1, массив2, нормаЧасов, оклад);
    установитьРезультаты(новыеРезультаты);
  }, [массив1, массив2, нормаЧасов, оклад]);
  const handleInputChange = (event, setState) => {
    const { value } = event.target;
    const новыйМассив = value.split(',').map(Number);
    setState(Array.isArray(новыйМассив) ? новыйМассив : parseInt(value, 10));
  };
  const lineStyle = {
    border: '1px solid black',
    height: '0',
  };

  return (
    <div className="App list">
      <label>
        Норма часов:
        <input type="number" value={нормаЧасов} onChange={(e) => handleInputChange(e, установитьНормуЧасов)} />
      </label>

      <label>
        Оклад:
        <input type="number" value={оклад} onChange={(e) => handleInputChange(e, установитьОклад)} />
      </label>

      <label>
        Дневные часы через запятую:
        <input type="text" value={массив1.join(',')} onChange={(e) => handleInputChange(e, установитьМассив1)} />
      </label>

      <label>
        Ночные часы через запятую:
        <input type="text" value={массив2.join(',')} onChange={(e) => handleInputChange(e, установитьМассив2)} />
      </label>

      <button onClick={рассчитатьИтоговуюЗП}>Рассчитать</button>

      {/* Вывод результатов */}
      {результаты && (
        <div>
          <p>Норма часов: {нормаЧасов}</p>
          {/* <p>Общее количество переработок: {результаты.количествоПереработок}</p> */}
          <p>Дневных в составе нормы (часов): {результаты.суммаПервогоМассива}</p>
          <p>Ночных в составе нормы (часов): {результаты.суммаИзВторогоМассива}</p>
          <p>Переработки день: {результаты.суммаОставшихсяЧасовМассив1}</p>
          <p>Переработки ночь: {результаты.суммаОставшихсяЧасовМассив2}</p>
          <p>Итого часов: {результаты.итого}</p>
          <p>Цена часа: {результаты.ценаЧаса}руб</p>
          <p>Цена часа переработки: {результаты.ценаЧасаПереработки}руб</p>
          <p>сумма за ночные в составе нормы (рублей): {результаты.суммаИзВторогоМассива*ценаЧаса*1.2 - (результаты.суммаИзВторогоМассива*ценаЧаса) }руб</p>
          <p>Переработки день: {результаты.суммаОставшихсяЧасовМассив1*ценаЧасаПереработки}руб</p>
          <p>Переработки ночь: {результаты.суммаОставшихсяЧасовМассив2*ценаЧасаПереработки*1.2} руб</p>
          <p>Итоговая сумма за переработки { Math.round(результаты.суммаОставшихсяЧасовМассив2*ценаЧасаПереработки*1.2+результаты.суммаОставшихсяЧасовМассив1*ценаЧасаПереработки+результаты.суммаИзВторогоМассива*ценаЧаса*1.2 - (результаты.суммаИзВторогоМассива*ценаЧаса) + (результаты.количествоПереработок*ценаЧаса))} руб (если прибавить ваш оклад, будет итоговая зп)</p>
          <p>Итоговая зп { Math.round(оклад+результаты.суммаОставшихсяЧасовМассив2*ценаЧасаПереработки*1.2+результаты.суммаОставшихсяЧасовМассив1*ценаЧасаПереработки+результаты.суммаИзВторогоМассива*ценаЧаса*1.2 - (результаты.суммаИзВторогоМассива*ценаЧаса) + (результаты.количествоПереработок*ценаЧаса))} руб</p>
          <h2>Инструкция</h2>
          <h3>На данный момент программа считает зп только, если у вас есть переработки, т.е. выполненна норма часов </h3>
          <h4>В поле ввода дневных часов необходимо по очереди ввести через запятую ваши часы,
            в следующее окно необходимо ввести ночные часы. <br/>
            Первое число Первого  списка - количество часов, отработанных днем первого рабочего дня месяца, и тд;  <br/>
            Первое число Второго списка - количество часов,  отработанных ночью первого рабочего дня месяца и тд; <br/>
            Если вы не работали в определенные дни ночью, но работали днем, необходимо поставить 0 в соответствующем списке, то же самое касается дня </h4>
            <img src={pict}/><br/>
            Данный пример означает, что вы отработали:<br/>
            в первый рабочий день: 10 дневных и 0 ночных;<br/>
            во второй рабочий день: 0 дненвых и 10 ночных;<br/>
            в третий рабочий день: 10 дневных и 10 ночных.<br/>
            <div style={lineStyle}></div><br/>
            Значение параметров:<br/>
            Дневных в составе нормы (часов) - сколько у вас было дневных часов, до выполнения нормы;<br/>
            Ночных в составе нормы (часов) - сколько у вас было ночных часов, до выполнения нормы;<br/>
            Переработки день - сколько у вас было дневных часов, после выполнения нормы;<br/>
            Переработки ночь - сколько у вас было ночных часов, после  выполнения нормы;<br/>
            Итого часов - всего ваших часов;<br/>
            сумма за ночные в составе нормы (рублей) - ваш бонус за ночные смены, за часы, до набора нормы;<br/>
            Переработки день - то, сколько вам должны заплатить за все переработки за дневные часы <br/>
            Переработки ночь - то, сколько вам должны заплатить за все переработки за ночные  часы <br/>
            Итоговая сумма за переработки - сумма всех доплат за переработки, а именно сложение трех предыдущих значений<br/>
            Итоговая зп - сложение предыдущего параметра + ваш оклад ( данная функция пока что может работать некорректно, поэтому лучше пользуйтесь предыдущим параметром, прибавляя к нему оклад)<br/>
            <h3>Все расчеты выполнены с учетом НДФЛ</h3>
        </div>
      )}
    </div>
  );
}

export default App;

function рассчитатьЗарплату(массив1, массив2, нормаЧасов, оклад) {
  let общаяСумма = 0;
  let суммаПервогоМассива = 0;
  let суммаИзВторогоМассива = 0;
  let оставшиеЧасыМассив1 = 0;
  let оставшиеЧасыМассив2 = 0;
  let суммаОставшихсяЧасовМассив1 = 0;
  let суммаОставшихсяЧасовМассив2 = 0;

  let i = 0;
  let j = 0;

  while (i < массив1.length || j < массив2.length) {
    if (i < массив1.length) {
      общаяСумма += массив1[i];
      суммаПервогоМассива += массив1[i];
      оставшиеЧасыМассив1 += массив1[i];
      i++;
    }

    if (общаяСумма >= нормаЧасов) {
      break;
    }

    if (j < массив2.length) {
      общаяСумма += массив2[j];
      суммаИзВторогоМассива += массив2[j];
      оставшиеЧасыМассив2 += массив2[j];
      j++;
    }

    if (общаяСумма >= нормаЧасов) {
      break;
    }
  }

  // Рассчитываем суммы оставшихся часов после набора нормы
  суммаОставшихсяЧасовМассив1 = массив1.slice(i).reduce((acc, curr) => acc + curr, 0);
  суммаОставшихсяЧасовМассив2 = массив2.slice(j).reduce((acc, curr) => acc + curr, 0);

  const итого = массив1.concat(массив2).reduce((acc, curr) => acc + curr, 0);
  const оставшаяСумма = Math.max(0, общаяСумма - нормаЧасов);
  const количествоПереработок = оставшаяСумма;

  const ценаЧаса = оклад / нормаЧасов;
  const ценаЧасаПереработки = ценаЧаса * 1.5; // Пусть переработка оплачивается с коэффициентом 1.5

  return {
    общаяСумма,
    суммаПервогоМассива,
    суммаИзВторогоМассива,
    оставшаяСумма,
    количествоПереработок,
    итого,
    ценаЧаса,
    ценаЧасаПереработки,
    оставшиеЧасыМассив1,
    оставшиеЧасыМассив2,
    суммаОставшихсяЧасовМассив1,
    суммаОставшихсяЧасовМассив2
  };
}
